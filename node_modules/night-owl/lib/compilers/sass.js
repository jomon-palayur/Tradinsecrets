import path from "node:path"
import { compileString } from "sass"

export default async (content, filename, options) => {
  const { css, loadedUrls } = compileString(content, {
    style: process.env.NIGHTOWL_MODE === "build" ? "compressed" : "expanded",
    syntax: filename.endsWith(".sass") ? "indented" : "scss",
    url: "file://" + path.resolve(filename),
    ...options,
  })

  const dependencies = loadedUrls.map((dep) =>
    path.relative(process.cwd(), dep.pathname)
  )

  return {
    ext: ".css",
    content: css,
    dependencies,
  }
}
