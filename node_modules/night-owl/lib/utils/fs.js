import fs from "node:fs/promises"
import { constants } from "node:fs"
import path from "node:path"

import { warn, fail } from "../utils/logger.js"

export const exists = async (path) =>
  path
    ? await fs
        .access(path, constants.F_OK)
        .then(() => true)
        .catch(() => false)
    : false

export const mkdir = async (dir) => {
  if (!(await exists(dir))) await fs.mkdir(dir, { recursive: true })
}

export const write = (filename, content) => {
  if (!filename) {
    fail(`No filename for rendered content`)
    return Promise.resolve(null)
  }

  if (!content && content !== "") {
    warn(
      `Ignoring empty file "${filename}"`,
      `If this is intentional, return an empty string instead`
    )
    return Promise.resolve(null)
  }

  return mkdir(path.dirname(filename)).then(() =>
    fs.writeFile(filename, content)
  )
}
