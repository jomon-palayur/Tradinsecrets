import path from "node:path"
import slugify from "./slugify.js"

export default (filename, trailingSlash, stripSortPrefix) => {
  if (stripSortPrefix) {
    filename = filename.replace(/(^|\/|\\\\)\d+[\-_]/g, "$1")
  }

  const { dir, name, ext } = path.parse(filename)

  filename = path.join(dir, slugify(name) + ext)
  filename = filename.replace(/((\/|^)index)?\.html$/, "")

  if (trailingSlash && !path.extname(filename)) filename += "/"

  const url = new URL(filename, "file://")

  return url.pathname
}
